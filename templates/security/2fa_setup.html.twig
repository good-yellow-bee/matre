{% extends 'admin/base.html.twig' %}

{% block title %}Set Up Two-Factor Authentication{% endblock %}

{% block body %}
{# Page Header #}
<div class="bg-white rounded-xl border border-slate-200 p-6 shadow-sm mb-6">
    <div class="flex items-center gap-4">
        <div class="h-12 w-12 rounded-xl bg-blue-100 flex items-center justify-center">
            <i class="bi bi-shield-lock text-xl text-blue-600"></i>
        </div>
        <div>
            <h1 class="text-xl font-semibold text-slate-900">Set Up Two-Factor Authentication</h1>
            <p class="text-sm text-slate-500 mt-0.5">Add an extra layer of security to your account</p>
        </div>
    </div>
</div>

{# Alert for enforcement #}
<div class="p-4 mb-6 bg-amber-50 border border-amber-200 rounded-lg">
    <div class="flex items-start gap-3">
        <i class="bi bi-exclamation-triangle text-amber-600 text-xl"></i>
        <div>
            <h3 class="font-semibold text-amber-800">Two-factor authentication is required</h3>
            <p class="text-sm text-amber-700 mt-1">
                Your administrator has enabled mandatory 2FA. Please complete the setup below to continue accessing the admin panel.
            </p>
        </div>
    </div>
</div>

<div class="card">
    <div class="card-body">
        <div class="row">
            {# Left Column - QR Code #}
            <div class="col-md-6 border-end">
                <h5 class="mb-3 fw-semibold">
                    <span class="badge bg-primary rounded-pill me-2">1</span>
                    Scan QR Code
                </h5>
                <p class="text-muted mb-4">
                    Scan this QR code with your authenticator app (Google Authenticator, Authy, Microsoft Authenticator, etc.)
                </p>

                <div class="text-center mb-4">
                    <div class="d-inline-block p-3 bg-white border rounded-lg shadow-sm">
                        <img src="{{ qrCode }}" alt="QR Code for TOTP Setup" class="d-block">
                    </div>
                </div>

                <div class="mb-4">
                    <h6 class="text-muted mb-2">Or enter code manually:</h6>
                    <div class="p-3 bg-slate-50 border rounded-lg">
                        <code class="d-block text-center user-select-all fs-6" style="letter-spacing: 2px; word-break: break-all;">
                            {{ secret }}
                        </code>
                    </div>
                    <small class="text-muted d-block mt-2">
                        <i class="bi bi-info-circle me-1"></i>
                        Select "Time-based" or "TOTP" in your authenticator app
                    </small>
                </div>
            </div>

            {# Right Column - Verification #}
            <div class="col-md-6">
                <h5 class="mb-3 fw-semibold">
                    <span class="badge bg-primary rounded-pill me-2">2</span>
                    Verify Setup
                </h5>
                <p class="text-muted mb-4">
                    Enter the 6-digit code shown in your authenticator app to verify the setup is working correctly.
                </p>

                <form method="post" class="mt-4">
                    <div class="mb-4">
                        <label for="code" class="form-label fw-semibold">Verification Code</label>
                        <input
                            type="text"
                            name="code"
                            id="code"
                            class="form-control form-control-lg text-center"
                            inputmode="numeric"
                            pattern="[0-9]*"
                            maxlength="6"
                            required
                            autofocus
                            placeholder="000000"
                            style="font-size: 1.5rem; letter-spacing: 0.5em;">
                        <div class="form-text mt-2">
                            The code changes every 30 seconds
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary btn-lg w-100">
                        <i class="bi bi-check-circle me-2"></i>
                        Enable Two-Factor Authentication
                    </button>
                </form>

                <div class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                    <h6 class="text-blue-800 mb-2">
                        <i class="bi bi-lightbulb me-1"></i> Tips
                    </h6>
                    <ul class="text-sm text-blue-700 mb-0 ps-3">
                        <li>Make sure your phone's time is synced automatically</li>
                        <li>The code refreshes every 30 seconds</li>
                        <li>If codes don't work, try waiting for a new one</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

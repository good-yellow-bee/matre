{% extends 'admin/base.html.twig' %}

{% block title %}Test History{% if testId %}: {{ testId }}{% endif %}{% endblock %}

{% block body %}
<div class="dashboard-welcome mb-4">
    <h1>Test History</h1>
    {% if testId and environment %}
        <p class="subtitle">
            Test <code>{{ testId }}</code> on {{ environment.name }}
        </p>
    {% else %}
        <p class="subtitle">View execution history for a specific test</p>
    {% endif %}
</div>

{% if testId and environmentId %}
    <div
        data-vue-island="test-history"
        data-api-url="{{ path('api_test_history') }}"
        data-test-id="{{ testId }}"
        data-environment-id="{{ environmentId }}"
        data-environments="{{ environments|map(e => {id: e.id, name: e.name})|json_encode|e('html_attr') }}"
        data-test-run-base-url="/admin/test-runs/__ID__"
    ></div>
{% else %}
    <div class="card shadow-sm">
        <div class="card-header">
            <h5 class="mb-0"><i class="bi bi-search me-2"></i>Search Test History</h5>
        </div>
        <div class="card-body">
            <form method="get" action="{{ path('admin_test_history') }}">
                <div class="row g-3 align-items-end">
                    <div class="col-md-5">
                        <label for="testId" class="form-label">Test ID</label>
                        <input type="text" class="form-control" id="testId" name="testId"
                               placeholder="e.g., MOEC5157" required>
                    </div>
                    <div class="col-md-5">
                        <label for="environmentId" class="form-label">Environment</label>
                        <select class="form-select" id="environmentId" name="environmentId" required>
                            <option value="">Select environment...</option>
                            {% for env in environments %}
                                <option value="{{ env.id }}">{{ env.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-2">
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="bi bi-search me-1"></i>Search
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <div class="alert alert-info mt-3">
        <i class="bi bi-info-circle me-2"></i>
        Or use the <strong>History</strong> button from a test result row in any test run.
    </div>
{% endif %}
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    {% if testId and environmentId %}
        {{ vite_entry_script_tags('test-history-app') }}
    {% endif %}
{% endblock %}
